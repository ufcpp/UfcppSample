<!DOCTYPE html>
<html>
<head>
<title>ãƒ†ã‚­ã‚¹ãƒˆ Canvas ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°</title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
</head>
<body>

    <table title="ãƒ†ã‚­ã‚¹ãƒˆã‚’ Canvas ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™">
        <tr>
            <td title="ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãŸã„æ–‡å­—ã‚’ç›´æ¥å…¥åŠ›ã—ã¾ã™">ç›´æ¥å…¥åŠ›</td>
            <td><input type="text" id="rawText" size="70" onfocus="this.select()" value="ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"></td>
            <td><input type="button" id="rawButton" value="run"></td>
        </tr>
        <tr title="ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã®16é€²æ•°ã§ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä¸¦ã¹ã¦å…¥åŠ›ã—ã¾ã™">
            <td>ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</td>
            <td><input type="text" id="cpText" size="70" onfocus="this.select()" value=""></td>
            <td><input type="button" id="cpButton" value="run"></td>
        </tr>
    </table>
    <div title="Canvas èƒŒæ™¯ã‚’ transparent ã«ã—ã¦ã‚ã‚‹ã®ã§ã€ã€Œç”»åƒã‚’ã‚³ãƒ”ãƒ¼ã€ã§é€éç”»åƒåŒ–ã§ãã¾ã™">
        <canvas id="canvas" width="150" height="120" style="background-color: transparent; padding: 0; margin: 0; font-size: 80px;"></canvas>
    </div>

    <script>
        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');
        context.font = "80px sans-serif";

        function runRaw(){
            var raw = $("#rawText").val();
            var codePoints = [...raw];

            var encoded = "";
            codePoints.forEach(x => {
                if (encoded != "") { encoded += ' '; }
                encoded += x.codePointAt().toString(16);
            });

            context.clearRect(0, 0, 150, 120);
            context.fillText(raw, 0, 90);

            $("#cpText").val(encoded);
        }

        function runCp(){
            var s = $("#cpText").val();
            var seq = s.split(' ');
            var codePoints = [];

            seq.forEach(x => {
                codePoints.push(parseInt(x, 16));
            });
            var decoded = String.fromCodePoint(...codePoints);

            context.clearRect(0, 0, 150, 120);
            context.fillText(decoded, 0, 90);

            $("#rawText").val(decoded);
        }

        $("#rawText").keydown(() => { if( window.event.keyCode == 13 ) { runRaw(); } });
        $("#cpText").keydown(() => { if( window.event.keyCode == 13 ) { runCp(); } });
        $("#rawButton").click(runRaw);
        $("#cpButton").click(runCp);

        runRaw();
    </script>
</body>
</html>
